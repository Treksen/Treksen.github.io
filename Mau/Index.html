<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Animated Map</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
  <style>
    #map {
      height: 500px;
    }
  </style>
</head>
<body>
  <h1>Animated Map</h1>
  <div id="map"></div>
  <div id="controls">
    <button id="play">Play</button>
    <button id="pause">Pause</button>
    <input type="range" id="slider" min="0" max="10" step="1" value="0">
  </div>
  <script>
   // define your data as an array of objects with timestamps
    const data = [
      {
        timestamp: "2022-01-01",
        deforestation: 5000,
        afforestation: 2000
      },
      {
        timestamp: "2022-02-01",
        deforestation: 6000,
        afforestation: 3000
      },
      {
        timestamp: "2022-03-01",
        deforestation: 7000,
        afforestation: 4000
      },
      {
        timestamp: "2022-04-01",
        deforestation: 8000,
        afforestation: 5000
      },
      {
        timestamp: "2022-05-01",
        deforestation: 9000,
        afforestation: 6000
      },
      {
        timestamp: "2022-06-01",
        deforestation: 10000,
        afforestation: 7000
      },
      {
        timestamp: "2022-07-01",
        deforestation: 11000,
        afforestation: 8000
      },
      {
        timestamp: "2022-08-01",
        deforestation: 12000,
        afforestation: 9000
      },
      {
        timestamp: "2022-09-01",
        deforestation: 13000,
        afforestation: 10000
      },
      {
        timestamp: "2022-10-01",
        deforestation: 14000,
        afforestation: 11000
      },
      {
        timestamp: "2022-11-01",
        deforestation: 15000,
        afforestation: 12000
      },
      {
        timestamp: "2022-12-01",
        deforestation: 16000,
        afforestation: 13000
      }
    ];

    // initialize the map
    const map = L.map('map').setView([-0.8, 35.5], 8);

    // add a tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
      maxZoom: 18,
      id: 'mapbox.streets'
    }).addTo(map);

    // define a function to add a GeoJSON layer to the map
    function addGeoJSONLayer(timestamp) {
      // create a GeoJSON layer based on your data for the given timestamp
      const geojson = {
        type: "FeatureCollection",
        features: [
          {
            type: "Feature",
            geometry: {
              type: "Point",
              coordinates: [35.5, -0.8]
            },
            properties: {
              deforestation: data[timestamp].deforestation,
              afforestation: data[timestamp].afforestation
            }
          }
        ]
      };

      // define a function to style the GeoJSON layer based on the deforestation and afforestation values
      function style(feature) {
        return {
          fillColor: feature.properties.deforestation > feature.properties.afforestation ? "#d7191c" : "#1a9641",
          fillOpacity: 0.7,
          radius: Math.sqrt(feature.properties.deforestation + feature.properties.afforestation) / 50
        };
      }

      // add the GeoJSON layer to the map and bind a popup with the timestamp and deforestation/afforestation values
      L.geoJSON(geojson, {
        pointToLayer: function(feature, latlng) {
          return L.circleMarker(latlng, style(feature));
        }
      }).bindPopup(`<strong>${data[timestamp].timestamp}</strong><br>Deforestation: ${data[timestamp].deforestation} ha<br>Afforestation: ${data[timestamp].afforestation} ha`).addTo(map);
    }
    // define a function to add a GeoJSON layer to the map
    function addGeoJSON(data) {
      // define the GeoJSON data
      const geojson = {
        type: "FeatureCollection",
        features: [
          {
            type: "Feature",
            geometry: {
              type: "Point",
              coordinates: [35.5, -0.8]
            },
            properties: {
              name: "Mau Forest",
              deforestation: data[0].deforestation,
              afforestation: data[0].afforestation
            }
          }
        ]
      };

      // add the GeoJSON layer to the map and bind a popup to it
      const layer = L.geoJSON(geojson, {
        pointToLayer: function (feature, latlng) {
          const marker = L.circleMarker(latlng, {
            radius: 10,
            fillColor: "#f00",
            fillOpacity: 0.5,
            stroke: false
          });
          return marker;
        }
      }).addTo(map);
      layer.bindPopup(`<h2>${geojson.features[0].properties.name}</h2><p>Deforestation: ${geojson.features[0].properties.deforestation}</p><p>Afforestation: ${geojson.features[0].properties.afforestation}</p>`);

      // define a time slider using the jQuery UI slider
      $("#slider").slider({
        range: "min",
        min: 0,
        max: data.length - 1,
        slide: function (event, ui) {
          // update the marker popup content and circle radius
          const deforestation = data[ui.value].deforestation;
          const afforestation = data[ui.value].afforestation;
          layer.getLayers()[0].setRadius(Math.sqrt(deforestation) / 10);
          layer.getLayers()[0].setStyle({
            fillColor: "#f00",
            fillOpacity: Math.sqrt(deforestation) / 10000
          });
          layer.bindPopup(`<h2>${geojson.features[0].properties.name}</h2><p>Deforestation: ${deforestation}</p><p>Afforestation: ${afforestation}</p>`);
        }
      });

      // define a function to update the time slider and marker every second
      let interval;
      function animate() {
        let i = $("#slider").slider("value");
        if (i == data.length - 1) {
          i = 0;
        } else {
          i++;
        }
        $("#slider").slider("value", i);
        if (i == data.length - 1) {
          clearInterval(interval);
          $("#play").prop("disabled", false);
        }
      }

      // add event listeners to the play and pause buttons
      $("#play").click(function () {
        $(this).prop("disabled", true);
        $("#pause").prop("disabled", false);
        interval = setInterval(animate, 1000);
      });
      $("#pause").click(function () {
        $(this).prop("disabled", true);
        $("#play").prop("disabled", false);
        clearInterval(interval);
      });
    }

    // call the addGeoJSON function with the data
    addGeoJSON(data);
  </script>
</body>
</html>
